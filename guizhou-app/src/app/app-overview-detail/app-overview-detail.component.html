<app-header [title]="title"></app-header>
<nz-content class="mirror-store-wrapper">
  <div class="link-back">
    <a [routerLink]="['/appOverview']">
      <span class="glyphicon glyphicon-menu-left"></span>
      返回</a>
  </div>
  <div class="detail-img-wrapper">
    <div class="img-block">
      <p class="detail-title" *ngIf="appInstanceDetail">{{appInstanceDetail.instanceName}}</p>
    </div>
    <div class="long-block"></div>
    <div class="action-block">
      <!--<nz-select  style="width: 120px;"
                  [(ngModel)]="selectedOption"
                  [nzPlaceHolder]="'更新'"
                  (ngModelChange)="alertModel($event);"
      >
        <nz-option
          *ngFor="let option of options"
          [nzLabel]="option.label"
          [nzValue]="option"
          [nzDisabled]="option.disabled"
        ></nz-option>
      </nz-select>-->
      <button nz-button [nzType]="'primary'" (click)="showModal()">
        <span>更新</span>
      </button>
      <nz-modal [nzVisible]="isVisible" [nzTitle]="'版本升级'" [nzContent]="modalContent" (nzOnCancel)="handleCancel($event)" (nzOnOk)="handleOk($event)">
        <ng-template #modalContent>
          <div>
            <div class="modal-div">
              <div class="modal-tem"></div>
              <span class="modal-label">应用名称</span>
              <span class="modal-cont" *ngIf="instanceVersions && appInstanceDetail.app">{{appInstanceDetail.app.appName}}</span>
              <div class="modal-tem"></div>
            </div>
            <div class="modal-div">
              <div class="modal-tem"></div>
              <span class="modal-label">当前版本</span>
              <span class="modal-cont"*ngIf="instanceVersions && appInstanceDetail.app">{{appInstanceDetail.app.version}}</span>
              <div class="modal-tem"></div>
            </div>
            <div class="modal-div">
              <div class="modal-tem"></div>
              <span class="modal-label">升级版本</span>

              <nz-select  class="modal-cont"
                          style="width: 120px;"
                          [(ngModel)]="selectedVersion"
                          (ngModelChange)="alertModel($event);"
              >
                <nz-option
                  *ngFor="let option of versionOptions"
                  [nzLabel]="option"
                  [nzValue]="option"
                ></nz-option>
              </nz-select>
              <div class="modal-tem"></div>

            </div>
          </div>
          <nz-spin [nzSize]="'large'" [nzSpinning]="_isSpinning" [nzTip]="'更新中'" style="text-align: center;">
          </nz-spin>
        </ng-template>

      </nz-modal>
    </div>
  </div>
  <div nz-row class="detail-desc-wrapper">
    <div nz-col [nzSpan]="12" class="detail-12col first-line">
      <div class="detail-line">
        <span>应用版本</span>
        <span class="detail-line-value" *ngIf="appInstanceDetail && appInstanceDetail.app">{{appInstanceDetail.app.version}}</span></div>
    </div>
    <div nz-col [nzSpan]="12" class="detail-12col first-line">
      <div class="detail-line">
        <span>应用状态</span>
        <span class="detail-line-value" *ngIf="appInstanceDetail">{{appInstanceDetail.status}}</span>
      </div>
    </div>
    <div nz-col [nzSpan]="12" class="detail-12col">
      <div class="detail-line">
        <span>创建时间</span>
        <span class="detail-line-value" *ngIf="appInstanceDetail">{{appInstanceDetail.createTime | date:'yyyy-MM-dd HH:mm:ss'}}</span></div>
    </div>
    <div nz-col [nzSpan]="12" class="detail-12col">
      <div class="detail-line">
        <span>更新时间</span>
        <span class="detail-line-value" *ngIf="appInstanceDetail">
<!--
          {{appInstanceDetail.updateTime | date:'yyyy-MM-dd HH:mm:ss'}}
-->
           {{!appInstanceDetail.updateTime ? '暂无': appInstanceDetail.updateTime | date:'yyyy-MM-dd HH:mm:ss'}}
        </span></div>
    </div>

    <div nz-col [nzSpan]="12" class="detail-12col">
      <div class="detail-line">
        <span>所属域名</span>
        <span class="detail-line-value">B域</span></div>
    </div>
  </div>

  <nz-tabset [nzTabPosition]="'top'" [nzType]="'card'" class="mirrorTab">
    <nz-tab *ngFor="let tab of tabs" (nzClick)="changeTabName(tab.tabName)">
      <ng-template #nzTabHeading>
        {{tab.name}}
      </ng-template>
      <nz-table #nzTable
                [nzAjaxData]="_dataSet"
                [nzShowSizeChanger]="true"
                [nzShowTotal]="true"
                [nzLoading]="_loading"
                [nzTotal]="_total"
                [(nzPageIndex)]="_current"
                (nzPageIndexChange)="refreshData()"
                [(nzPageSize)]="_pageSize"
                (nzPageSizeChange)="refreshData(true)">
        <thead nz-thead>
        <tr>
          <th nz-th>
            <span>实例名称</span>
            <nz-table-sort [(nzValue)]="sortMap.microserviceName"
                           (nzValueChange)="sort('microserviceName', $event)"></nz-table-sort>
          </th>
          <th nz-th>
            <span>所属集群</span>
            <nz-table-sort [(nzValue)]="sortMap.clusterName"
                           (nzValueChange)="sort('clusterName', $event)"></nz-table-sort>
          </th>
          <th nz-th>
            <span>镜像 | 服务名称</span>
            <nz-table-sort [(nzValue)]="sortMap.repository"
                           (nzValueChange)="sort('repository', $event)"></nz-table-sort>
          </th>
          <th nz-th>
            <span>状态</span>
            <nz-table-sort [(nzValue)]="sortMap.status"
                           (nzValueChange)="sort('status', $event)"></nz-table-sort>
          </th>
          <th nz-th>
            <span>容器数量</span>
            <nz-table-sort [(nzValue)]="sortMap.podsCount"
                           (nzValueChange)="sort('podsCount', $event)"></nz-table-sort>
          </th>
          <th nz-th>
            <span>大小</span>
            <nz-table-sort [(nzValue)]="sortMap.storageSize"
                           (nzValueChange)="sort('storageSize', $event)"></nz-table-sort>
          </th>
        </tr>
        </thead>
        <tbody nz-tbody>
        <tr nz-tbody-tr *ngFor="let data of nzTable.data  | appFilter: 'instanceName' : keyword">
          <td nz-td>
            <a *ngIf="tabName === 'microservices'"
               [routerLink]="['/appInstanceDetailDetail', instanceId, data.id]">
              {{data.microserviceName ||data.instanceName}}
            </a>
            <a  *ngIf="tabName === 'serviceInstances'"
                [routerLink]="['/serviceInstanceDetail', data.id]">
              {{data.microserviceName ||data.instanceName}}
            </a>
          </td>
          <td nz-td>{{data.clusterName}}</td>
          <td nz-td>{{data.repository||data.serviceName}}</td>
          <td nz-td>{{data.status}}</td>
          <td nz-td>{{data.podsCount || data.instancesCount}}</td>
          <td nz-td>{{data.cpuSize}}核 {{data.memSize}}M</td>
        </tr>
        </tbody>
      </nz-table>
    </nz-tab>
  </nz-tabset>
</nz-content>
