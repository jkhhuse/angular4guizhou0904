<div style="padding:20px">
  <nz-steps [(nzCurrent)]="current">
    <nz-step [nzTitle]="'灰度部署'"></nz-step>
    <nz-step [nzTitle]="'镜像配置'"></nz-step>
    <nz-step [nzTitle]="'服务配置'"></nz-step>
    <nz-step [nzTitle]="'灰度策略'"></nz-step>
    <nz-step [nzTitle]="'部署成功'"></nz-step>
  </nz-steps>
  <div class="steps-content">
    <!-- {{index}} -->
    <!-- 这里是四个form，都写出来，然后每个是不同的div布局，可以把这四个分步骤表单看成一个页面，然后控制ngif可见性
          最后把四个form的数据封装到一起 -->
    <div>
      <!-- 应用部署 -->
      <div [hidden]="current !== 0">
        <nz-layout>
          <nz-content>
            <nz-content style="margin-top: 0;">
              <div class="marginTop20">
                <div class="borderTop80" style="border: 0;padding-top: 0;">
                  <nz-alert class="service-tips" [nzType]="'info'">
                    <span alert-body nz-row>
                      <div style="text-align: center; font-size: 20px; color:#10a5ef" nz-col [nzSpan]="1">
                        <i class="anticon anticon-exclamation-circle-o"></i>
                      </div>
                      <div nz-col [nzSpan]="21">
                        <div>
                          <p>帮助提示</p>
                          <span>灰度部署是指版本升级时平滑过渡的方式，用户可先进行灰度发布至新版本。经过部分用户试用稳定后，正式升级至高版本。</span>
                        </div>
                      </div>
                    </span>
                  </nz-alert>
                </div>
              </div>
            </nz-content>
            <div class="marginTop20">
              <p>灰度部署</p>
              <div class="borderTop80" nz-row>
                <dynamic-form #formFirstProject [config]="formFirst">
                </dynamic-form>
                <div nz-row>
                  <div nz-col [nzSpan]="4" style="text-align: right">
                    <span style="display: block;
                              font-size: 13px;
                              font-weight: 400;
                              letter-spacing: 0px;
                              margin-bottom: 10px;
                              color: rgba(0, 0, 0, 0.9);">资源池</span>
                  </div>
                  <div nz-col [nzSpan]="18" style="margin-left: 10px; margin-top: 4px">
                    <!-- <nz-radio-group [(ngModel)]="this.radioValue" (click)="toggleButton()"> -->
                    <nz-radio-group [(ngModel)]="this.radioValue">
                      <label nz-radio [nzValue]="'product'" style="margin-right: 25px">
                        <span>生产域</span>
                      </label>
                      <label nz-radio [nzValue]="'test'">
                        <span>测试域</span>
                      </label>
                    </nz-radio-group>
                  </div>
                </div>
              </div>
            </div>
          </nz-content>
        </nz-layout>
      </div>

      <!-- 镜像配置 -->
      <div [hidden]="current !== 1">
        <nz-layout>
          <nz-content>
            <nz-content style="margin-top: 0;">
              <div class="marginTop20">
                <div class="borderTop80" style="border: 0;padding-top: 0;">
                  <nz-alert class="service-tips" [nzType]="'info'">
                    <span alert-body nz-row>
                      <div style="text-align: center; font-size: 20px; color:#10a5ef" nz-col [nzSpan]="1">
                        <i class="anticon anticon-exclamation-circle-o"></i>
                      </div>
                      <div nz-col [nzSpan]="21">
                        <div>
                          <p>帮助提示</p>
                          <span>灰度部署是指版本升级时平滑过渡的方式，用户可先进行灰度发布至新版本。经过部分用户试用稳定后，正式升级至高版本。</span>
                        </div>
                      </div>
                    </span>
                  </nz-alert>
                </div>
              </div>
            </nz-content>
            <div class="marginTop20">
              <p>镜像配置</p>
              <div class="borderTop80">
                <nz-tabset [nzTabPosition]="'top'" [nzType]="'card'" [(nzSelectedIndex)]="activeImage">
                  <nz-tab (nzDeselect)="choosedImageFunc(tab)" (nzSelect)="choosedImageFunc1(tab)" *ngFor="let tab of imageTabs; let k=index">
                    <ng-template #nzTabHeading>
                      {{tab}}
                    </ng-template>
                    <!-- todo next 这里希望是通过tab的循环来定义不同的表单 -->
                    <!-- 可以查看componentTest的代码 -->
                    <!-- 测试<dynamic-form #formSecondProject [config]="formSecond">getValue('tabname')
                      </dynamic-form>这个，是可以出现两个表单的，但是数据也要处理一下 -->

                    <!-- 基本配置 -->
                    <div class="marginTop20">
                      <p class="borderBottom80">基本配置</p>
                      <div nz-row style="margin-bottom: 15px">
                        <div style="margin-bottom: 10px" *ngIf="this.radioValue === 'product'" nz-row>
                          <div nz-col [nzSpan]="4" style="text-align: right">
                            <span style="display: block;
                                      font-size: 13px;
                                      font-weight: 400;
                                      letter-spacing: 0px;
                                      margin-bottom: 10px;
                                      color: rgba(0, 0, 0, 0.9);">集群</span>
                          </div>
                          <div nz-col [nzSpan]="18" style="margin-left: 10px; margin-top: 4px">
                            <nz-radio-group (click)="changeNetwork(this.radioValue)" [(ngModel)]="this.networkRadioValue">
                              <label *ngFor="let cluster of prodCluster" nz-radio [nzValue]="cluster.name">
                                <span>{{ cluster.displayName }}</span>
                              </label>
                            </nz-radio-group>
                          </div>
                        </div>
                        <div style="margin-bottom: 10px" *ngIf="this.radioValue === 'test'" nz-row>
                          <div nz-col [nzSpan]="4" style="text-align: right">
                            <span style="display: block;
                                      font-size: 13px;
                                      font-weight: 400;
                                      letter-spacing: 0px;
                                      margin-bottom: 10px;
                                      color: rgba(0, 0, 0, 0.9);">集群</span>
                          </div>
                          <div nz-col [nzSpan]="18" style="margin-left: 10px; margin-top: 4px">
                            <nz-radio-group (click)="changeNetwork(this.radioValue)" [(ngModel)]="this.networkRadioValue2">
                              <label *ngFor="let cluster of testCluster" nz-radio [nzValue]="cluster.name">
                                <span>{{ cluster.name }}</span>
                              </label>
                            </nz-radio-group>
                          </div>
                        </div>
                        <dynamic-form *ngIf="k === 0" #formSecondProject0 [config]="formSecond">getValue('tabname')
                        </dynamic-form>
                        <dynamic-form *ngIf="k === 1" #formSecondProject1 [config]="formSecond">getValue('tabname')
                        </dynamic-form>
                        <dynamic-form *ngIf="k === 2" #formSecondProject2 [config]="formSecond">getValue('tabname')
                        </dynamic-form>
                        <dynamic-form *ngIf="k === 3" #formSecondProject3 [config]="formSecond">getValue('tabname')
                        </dynamic-form>
                        <dynamic-form *ngIf="k === 4" #formSecondProject4 [config]="formSecond">getValue('tabname')
                        </dynamic-form>
                        <div nz-row>
                          <div nz-col [nzSpan]="4" style="text-align: right">
                            <span style="display: block;
                              font-size: 13px;
                              font-weight: 400;
                              letter-spacing: 0px;
                              margin-bottom: 10px;
                              color: rgba(0, 0, 0, 0.9);">容器实例大小</span>
                          </div>
                          <div nz-col [nzSpan]="18" style="margin-left: 10px">
                            <app-container-instance #instanceSecond [config]="instanceConfig">
                            </app-container-instance>
                            <!-- <app-container-instance *ngIf="k === 0" #instanceSecond0 [config]="instanceConfig">
                            </app-container-instance>
                            <app-container-instance *ngIf="k === 1" #instanceSecond1 [config]="instanceConfig">
                            </app-container-instance>
                            <app-container-instance *ngIf="k === 2" #instanceSecond2 [config]="instanceConfig">
                            </app-container-instance>
                            <app-container-instance *ngIf="k === 3" #instanceSecond3 [config]="instanceConfig">
                            </app-container-instance>
                            <app-container-instance *ngIf="k === 4" #instanceSecond4 [config]="instanceConfig">
                            </app-container-instance> -->
                          </div>
                        </div>
                      </div>
                    </div>

                    <!-- 网络配置 -->
                    <div class="marginTop20">
                      <p class="borderBottom80">网络配置</p>
                      <div nz-row style="margin-bottom: 15px">
                        <div style="margin-bottom: 10px" nz-row>
                          <div nz-col [nzSpan]="4" style="text-align: right">
                            <span style="display: block;
                                      font-size: 13px;
                                      font-weight: 400;
                                      letter-spacing: 0px;
                                      margin-bottom: 10px;
                                      color: rgba(0, 0, 0, 0.9);">网络模式</span>
                          </div>
                          <div nz-col [nzSpan]="18" style="margin-left: 10px; margin-top: 4px">
                            <nz-radio-group [(ngModel)]="this.networkConfig">
                              <label nz-radio [nzValue]="'FLANNEL'">
                                <span>Flannel</span>
                              </label>
                            </nz-radio-group>
                          </div>
                        </div>
                      </div>
                      <!-- <dynamic-form #formImgNetworkProject [config]="formImgNetwork"></dynamic-form> -->
                      <!-- todo next -->
                      <div nz-row>
                        <div style="margin-bottom: 10px" nz-row>
                          <div nz-col [nzSpan]="4" style="text-align: right">
                          </div>
                          <div nz-col [nzSpan]="18" style="margin-left: 10px; margin-top: 4px">
                            <div nz-row>
                              <div nz-col [nzMd]="24">
                                <div nz-row [nzGutter]="16">
                                  <div nz-col [nzSpan]="label.value === '监听端口' ? '6' : '4'" *ngFor="let label of lbControlLabel">
                                    <span>{{ label.value }}</span>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div nz-row>
                        <div nz-row>
                          <div nz-col [nzSpan]="4" style="text-align: right">
                            <span style="display: block;
                                font-size: 13px;
                                font-weight: 400;
                                letter-spacing: 0px;
                                margin-bottom: 10px;
                                color: rgba(0, 0, 0, 0.9);">负载均衡器</span>
                          </div>
                          <div nz-col [nzSpan]="18" style="margin-left: 10px; margin-top: 4px">
                            <div nz-row>
                              <div nz-col [nzMd]="24">
                                <!-- <form *ngIf="k === 0" nz-form class="dynamic-form" [formGroup]="loadBanlancerForm0">
                                  <div nz-row [nzGutter]="16" *ngFor="let control1 of lbControlArray;let i=index">
                                    <div nz-col [nzSpan]="control.placeholder === '1~65535' ? '8' : '4'" *ngFor="let control of control1" [class.d-none]="!control.show">
                                      <div nz-form-item nz-row>
                                        <div *ngIf="control.type === 'input'" nz-form-control nz-col>
                                          <nz-input [ngModel]="control.defaultValue" [nzType]="control.inputType" [nzDisabled]="control.disabled" [nzSize]="'large'"
                                            [nzPlaceHolder]="control.placeholder" [formControlName]="control.name"></nz-input>
                                        </div>
                                        <div *ngIf="control.type === 'select'" nz-form-control nz-col [nzSm]="20">
                                          <nz-select [nzTags]="control.ifTags" (nzOpenChange)="lbEmit(control.name, i, k)" [formControlName]="control.name" [nzPlaceHolder]="control.placeholder"
                                            nzAllowClear [nzDisabled]="control.disabled">
                                            <nz-option *ngFor="let option of control.options" [nzValue]="option" [nzLabel]="option">
                                            </nz-option>
                                          </nz-select>
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                                </form> -->
                                <form nz-form class="dynamic-form" [formGroup]="judgeFuncLb(k)">
                                  <div nz-row [nzGutter]="16" *ngFor="let control1 of judgeFuncLbControl(k);let i=index">
                                    <div nz-col [nzSpan]="control.placeholder === '1~65535' ? '6' : '4'" *ngFor="let control of control1; let p=index" [class.d-none]="!control.show">
                                      <div nz-form-item nz-row>
                                        <div *ngIf="control.type === 'input'" nz-form-control nz-col>
                                          <nz-input [ngModel]="control.defaultValue" [nzType]="control.inputType" [nzDisabled]="control.disabled"
                                            [nzSize]="'large'" [nzPlaceHolder]="control.placeholder" [formControlName]="control.name"></nz-input>
                                        </div>
                                        <div *ngIf="control.type === 'select'" nz-form-control nz-col [nzSm]="20">
                                          <nz-select *ngIf="p === 1 || p === 2" style="width: 80%" [nzTags]="control.ifTags" (nzOpenChange)="lbEmit(control.name, i, k)" [formControlName]="control.name"
                                            [nzPlaceHolder]="control.placeholder" nzAllowClear [nzDisabled]="control.disabled">
                                            <nz-option *ngFor="let option of control.options" [nzValue]="option" [nzLabel]="option">
                                            </nz-option>
                                          </nz-select>
                                          <nz-select *ngIf="p !== 1 && p !== 2" style="width: 100%" [nzTags]="control.ifTags" (nzOpenChange)="lbEmit(control.name, i, k)" [formControlName]="control.name"
                                            [nzPlaceHolder]="control.placeholder" nzAllowClear [nzDisabled]="control.disabled">
                                            <nz-option *ngFor="let option of control.options" [nzValue]="option" [nzLabel]="option">
                                            </nz-option>
                                          </nz-select>
                                          <nz-tooltip *ngIf="p === 1" [nzTitle]="'容器暴露端口,手动输入请以回车键结束'" [nzPlacement]="'top'">
                                            <i nz-tooltip style="vertical-align: top" *ngIf="p === 1" class="anticon anticon-question-circle-o"></i>
                                          </nz-tooltip>
                                          <nz-tooltip *ngIf="p === 2" [nzTitle]="'如果选http,则输入域名'" [nzPlacement]="'top'">
                                            <i nz-tooltip style="vertical-align: top" *ngIf="p === 2" class="anticon anticon-question-circle-o"></i>
                                          </nz-tooltip>
                                        </div>
                                      </div>
                                    </div>
                                    <i class="anticon anticon-delete" (click)="deleteFunc('lb', i, k)"></i>
                                    <!-- <button (click)="deleteFunc('lb', i, k)">删除负载均衡</button> -->
                                  </div>
                                  <div nz-row>
                                    <div nz-row>
                                      <div nz-col [nzSpan]="18" style="margin-left: 10px; margin-bottom: 10px">
                                        <div nz-row>
                                          <button nz-button [nzType]="'dashed'" [nzSize]="'large'" class="ant-btn__block mt-md" (click)="addLb(k)">
                                            <i class="anticon anticon-plus"></i>
                                            <span>新增负载均衡</span>
                                          </button>
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                                </form>
                                <!-- <form *ngIf="k === 2" nz-form class="dynamic-form" [formGroup]="loadBanlancerForm2">
                                  <div nz-row [nzGutter]="16" *ngFor="let control1 of lbControlArray;let i=index">
                                    <div nz-col [nzSpan]="control.placeholder === '1~65535' ? '8' : '4'" *ngFor="let control of control1" [class.d-none]="!control.show">
                                      <div nz-form-item nz-row>
                                        <div *ngIf="control.type === 'input'" nz-form-control nz-col>
                                          <nz-input [ngModel]="control.defaultValue" [nzType]="control.inputType" [nzDisabled]="control.disabled" [nzSize]="'large'"
                                            [nzPlaceHolder]="control.placeholder" [formControlName]="control.name"></nz-input>
                                        </div>
                                        <div *ngIf="control.type === 'select'" nz-form-control nz-col [nzSm]="20">
                                          <nz-select [nzTags]="control.ifTags" (nzOpenChange)="lbEmit(control.name, i)" [formControlName]="control.name" [nzPlaceHolder]="control.placeholder"
                                            nzAllowClear [nzDisabled]="control.disabled">
                                            <nz-option *ngFor="let option of control.options" [nzValue]="option" [nzLabel]="option">
                                            </nz-option>
                                          </nz-select>
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                                </form>
                                <form *ngIf="k === 3" nz-form class="dynamic-form" [formGroup]="loadBanlancerForm3">
                                  <div nz-row [nzGutter]="16" *ngFor="let control1 of lbControlArray;let i=index">
                                    <div nz-col [nzSpan]="control.placeholder === '1~65535' ? '8' : '4'" *ngFor="let control of control1" [class.d-none]="!control.show">
                                      <div nz-form-item nz-row>
                                        <div *ngIf="control.type === 'input'" nz-form-control nz-col>
                                          <nz-input [ngModel]="control.defaultValue" [nzType]="control.inputType" [nzDisabled]="control.disabled" [nzSize]="'large'"
                                            [nzPlaceHolder]="control.placeholder" [formControlName]="control.name"></nz-input>
                                        </div>
                                        <div *ngIf="control.type === 'select'" nz-form-control nz-col [nzSm]="20">
                                          <nz-select [nzTags]="control.ifTags" (nzOpenChange)="lbEmit(control.name, i)" [formControlName]="control.name" [nzPlaceHolder]="control.placeholder"
                                            nzAllowClear [nzDisabled]="control.disabled">
                                            <nz-option *ngFor="let option of control.options" [nzValue]="option" [nzLabel]="option">
                                            </nz-option>
                                          </nz-select>
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                                </form>
                                <form *ngIf="k === 4" nz-form class="dynamic-form" [formGroup]="loadBanlancerForm4">
                                  <div nz-row [nzGutter]="16" *ngFor="let control1 of lbControlArray;let i=index">
                                    <div nz-col [nzSpan]="control.placeholder === '1~65535' ? '8' : '4'" *ngFor="let control of control1" [class.d-none]="!control.show">
                                      <div nz-form-item nz-row>
                                        <div *ngIf="control.type === 'input'" nz-form-control nz-col>
                                          <nz-input [ngModel]="control.defaultValue" [nzType]="control.inputType" [nzDisabled]="control.disabled" [nzSize]="'large'"
                                            [nzPlaceHolder]="control.placeholder" [formControlName]="control.name"></nz-input>
                                        </div>
                                        <div *ngIf="control.type === 'select'" nz-form-control nz-col [nzSm]="20">
                                          <nz-select [nzTags]="control.ifTags" (nzOpenChange)="lbEmit(control.name, i)" [formControlName]="control.name" [nzPlaceHolder]="control.placeholder"
                                            nzAllowClear [nzDisabled]="control.disabled">
                                            <nz-option *ngFor="let option of control.options" [nzValue]="option" [nzLabel]="option">
                                            </nz-option>
                                          </nz-select>
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                                </form> -->
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <!-- <div nz-row>
                        <div nz-row>
                          <div nz-col [nzSpan]="4" style="text-align: right">
                          </div>
                          <div nz-col [nzSpan]="18" style="margin-left: 10px; margin-bottom: 10px">
                            <div nz-row>
                              {{ k }}
                              <button nz-button [nzType]="'dashed'" [nzSize]="'large'" class="ant-btn__block mt-md" (click)="addLb(k)">
                                <i class="anticon anticon-plus"></i>
                                <span>新增负载均衡</span>
                              </button>
                            </div>
                          </div>
                        </div>
                      </div> -->
                    </div>

                    <!-- 高级配置 -->
                    <div class="marginTop20">
                      <p class="borderBottom80">高级配置</p>
                      <!-- 服务类型配置 -->
                      <div nz-row>
                        <div style="margin-bottom: 10px" nz-row>
                          <div nz-col [nzSpan]="4" style="text-align: right">
                            <span style="display: block;
                                  font-size: 13px;
                                  font-weight: 400;
                                  letter-spacing: 0px;
                                  margin-bottom: 10px;
                                  color: rgba(0, 0, 0, 0.9);">服务类型</span>
                          </div>
                          <div nz-col [nzSpan]="18" style="margin-left: 10px; margin-top: 4px">
                            <nz-radio-group *ngIf="k === 0" [(ngModel)]="serviceType0">
                              <label nz-radio [nzValue]="'stateless'">
                                <span>无状态服务</span>
                              </label>
                              <label nz-radio [nzValue]="'stateful'">
                                <span>有状态服务</span>
                              </label>
                            </nz-radio-group>
                            <nz-radio-group *ngIf="k === 1" [(ngModel)]="serviceType1">
                              <label nz-radio [nzValue]="'stateless'">
                                <span>无状态服务</span>
                              </label>
                              <label nz-radio [nzValue]="'stateful'">
                                <span>有状态服务</span>
                              </label>
                            </nz-radio-group>
                            <nz-radio-group *ngIf="k === 2" [(ngModel)]="serviceType2">
                              <label nz-radio [nzValue]="'stateless'">
                                <span>无状态服务</span>
                              </label>
                              <label nz-radio [nzValue]="'stateful'">
                                <span>有状态服务</span>
                              </label>
                            </nz-radio-group>
                            <nz-radio-group *ngIf="k === 3" [(ngModel)]="serviceType3">
                              <label nz-radio [nzValue]="'stateless'">
                                <span>无状态服务</span>
                              </label>
                              <label nz-radio [nzValue]="'stateful'">
                                <span>有状态服务</span>
                              </label>
                            </nz-radio-group>
                            <nz-radio-group *ngIf="k === 4" [(ngModel)]="serviceType4">
                              <label nz-radio [nzValue]="'stateless'">
                                <span>无状态服务</span>
                              </label>
                              <label nz-radio [nzValue]="'stateful'">
                                <span>有状态服务</span>
                              </label>
                            </nz-radio-group>
                          </div>
                        </div>
                      </div>
                      <!-- 有状态服务，存储卷 -->
                      <div *ngIf="judgeFuncStateful(k, 'radio') === 'stateful'" nz-row>
                        <div style="margin-bottom: 10px" nz-row>
                          <div nz-col [nzSpan]="4" style="text-align: right">
                            <span style="display: block;
                                    font-size: 13px;
                                    font-weight: 400;
                                    letter-spacing: 0px;
                                    margin-bottom: 10px;
                                    color: rgba(0, 0, 0, 0.9);">存储卷</span>
                          </div>
                          <div nz-col [nzSpan]="18" style="margin-left: 10px; margin-top: 4px">
                            <nz-table #nzTable [nzAjaxData]="judgeFuncStateful(k, 'data')" [nzIsPagination]="false">
                              <thead nz-thead>
                                <tr>
                                  <th nz-th>
                                    <span>镜像路径</span>
                                  </th>
                                  <th nz-th>
                                    <span>存储卷</span>
                                  </th>
                                  <th nz-th>
                                    <span>主机路径</span>
                                  </th>
                                  <th nz-th>
                                    <span>操作</span>
                                  </th>
                                </tr>
                              </thead>
                              <tbody nz-tbody>
                                <tr nz-tbody-tr *ngFor="let data of judgeFuncStateful(k, 'data'); let l=index;">
                                  <td nz-td>
                                    {{data.app_volume_dir}}
                                  </td>
                                  <td nz-td>{{data.volume_id}}</td>
                                  <td nz-td>{{data.volume_name}}</td>
                                  <td nz-td>
                                    <i class="anticon anticon-delete" (click)="deleteFunc('stateful', l, k)"></i>
                                    <!-- <button (click)="deleteFunc('stateful', l, k)">删除存储卷</button> -->
                                  </td>
                                </tr>
                              </tbody>
                            </nz-table>
                          </div>
                        </div>
                      </div>
                      <div *ngIf="judgeFuncStateful(k, 'radio') === 'stateful'" nz-row>
                        <div nz-row>
                          <div nz-col [nzSpan]="4" style="text-align: right">
                          </div>
                          <div nz-col [nzSpan]="18" style="margin-top: 10px; margin-left: 10px; margin-bottom: 10px">
                            <div nz-row>
                              <button nz-button [nzType]="'dashed'" [nzSize]="'large'" class="ant-btn__block mt-md" (click)="addStateful()">
                                <i class="anticon anticon-plus"></i>
                                <span>新增存储卷</span>
                              </button>
                            </div>
                          </div>
                        </div>
                      </div>
                      <!-- 日志文件配置 -->
                      <!-- <div nz-row>
                        <div style="margin-bottom: 10px" nz-row>
                          <div nz-col [nzSpan]="4" style="text-align: right">
                          </div>
                          <div nz-col [nzSpan]="18" style="margin-left: 10px; margin-top: 4px">
                            <div nz-row>
                              <div nz-col [nzMd]="20">
                                <div nz-row [nzGutter]="16">
                                  <div nz-col [nzSpan]="4" *ngFor="let label of serviceAdvancedLabel">
                                    <span>{{ label.value }}</span>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <dynamic-form *ngIf="k === 0" #logFormProject0 [config]="logFormConfig0">
                      </dynamic-form>
                      <dynamic-form *ngIf="k === 1" #logFormProject1 [config]="logFormConfig1">
                      </dynamic-form>
                      <dynamic-form *ngIf="k === 2" #logFormProject2 [config]="logFormConfig2">
                      </dynamic-form>
                      <dynamic-form *ngIf="k === 3" #logFormProject3 [config]="logFormConfig3">
                      </dynamic-form>
                      <dynamic-form *ngIf="k === 4" #logFormProject4 [config]="logFormConfig4">
                      </dynamic-form>
                      <div nz-row>
                        <div nz-row>
                          <div nz-col [nzSpan]="4" style="text-align: right">
                          </div>
                          <div nz-col [nzSpan]="18" style="margin-left: 10px; margin-bottom: 10px">
                            <div nz-row>
                              <button nz-button [nzType]="'dashed'" [nzSize]="'large'" class="ant-btn__block mt-md" (click)="addLogFile(k)">
                                <i class="anticon anticon-plus"></i>
                                <span>新增日志文件</span>
                              </button>
                            </div>
                          </div>
                        </div>
                      </div> -->
                      <!-- 日志文件重构 -->
                      <div nz-row>
                        <div style="margin-bottom: 10px" nz-row>
                          <div nz-col [nzSpan]="4" style="text-align: right">
                          </div>
                          <div nz-col [nzSpan]="18" style="margin-left: 10px; margin-top: 4px">
                            <div nz-row>
                              <div nz-col [nzMd]="20">
                                <div nz-row [nzGutter]="16">
                                  <div nz-col [nzSpan]="4" *ngFor="let label of serviceAdvancedLabel">
                                    <span>{{ label.value }}</span>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>

                      <div nz-row>
                        <div nz-row>
                          <div nz-col [nzSpan]="4" style="text-align: right">
                            <span style="display: block;
                                    font-size: 13px;
                                    font-weight: 400;
                                    letter-spacing: 0px;
                                    margin-bottom: 10px;
                                    color: rgba(0, 0, 0, 0.9);">日志文件</span>
                          </div>
                          <div nz-col [nzSpan]="18" style="margin-left: 10px; margin-top: 4px">
                            <div nz-row>
                              <div nz-col [nzMd]="20">
                                <form nz-form class="dynamic-form" [formGroup]="judgeFuncLog(k)">
                                  <!-- <div nz-row [nzGutter]="16"> -->
                                  <div nz-row [nzGutter]="16" nz-row *ngFor="let control1 of judgeFuncLog(k, 'config'); let i=index">
                                    <div nz-col [nzSpan]="20" *ngFor="let control of control1" [class.d-none]="!control.show">
                                      <div nz-form-item nz-row>
                                        <div *ngIf="control.type === 'input'" nz-form-control nz-col>
                                          <nz-input [nzSize]="'large'" [nzPlaceHolder]="control.placeholder" [formControlName]="control.name"></nz-input>
                                        </div>
                                      </div>
                                    </div>
                                    <i class="anticon anticon-delete" (click)="deleteFunc('log', i, k)"></i>
                                    <!-- <button (click)="deleteFunc('log', i, k)">删除日志文件</button> -->
                                  </div>
                                  <!-- </div> -->
                                </form>
                                <div nz-row>
                                  <div nz-row>
                                    <div nz-col [nzSpan]="18" style="margin-left: 10px; margin-bottom: 10px">
                                      <div nz-row>
                                        <button nz-button [nzType]="'dashed'" [nzSize]="'large'" class="ant-btn__block mt-md" (click)="addLogFile(k)">
                                          <i class="anticon anticon-plus"></i>
                                          <span>新增日志文件</span>
                                        </button>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <!-- 环境变量文件配置 -->
                      <div nz-row>
                        <div style="margin-bottom: 10px" nz-row>
                          <div nz-col [nzSpan]="4" style="text-align: right">
                          </div>
                          <div nz-col [nzSpan]="18" style="margin-left: 10px; margin-top: 4px">
                            <div nz-row>
                              <div nz-col [nzMd]="20">
                                <div nz-row [nzGutter]="16">
                                  <div nz-col [nzSpan]="4">
                                    <span>环境变量文件名称</span>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>

                      <div nz-row>
                        <div nz-row>
                          <div nz-col [nzSpan]="4" style="text-align: right">
                            <span style="display: block;
                                  font-size: 13px;
                                  font-weight: 400;
                                  letter-spacing: 0px;
                                  margin-bottom: 10px;
                                  color: rgba(0, 0, 0, 0.9);">环境变量文件</span>
                          </div>

                          <div nz-col [nzSpan]="18" style="margin-left: 10px; margin-top: 4px">
                            <div nz-row>
                              <div nz-col [nzMd]="20">
                                <form nz-form class="dynamic-form" [formGroup]="judgeFuncEnvFile(k)">
                                  <!-- <div nz-row [nzGutter]="16"> -->
                                  <div nz-row [nzGutter]="16" nz-row *ngFor="let control1 of judgeFuncEnvFile(k, 'config'); let i=index">
                                    <div nz-col [nzSpan]="20" *ngFor="let control of control1" [class.d-none]="!control.show">
                                      <div nz-form-item nz-row>
                                        <div *ngIf="control.type === 'select'" nz-form-control nz-col [nzSm]="20">
                                          <nz-select [nzTags]="control.ifTags" [formControlName]="control.name" [nzPlaceHolder]="control.placeholder" nzAllowClear
                                            [nzDisabled]="control.disabled">
                                            <nz-option *ngFor="let option of control.options" [nzValue]="option" [nzLabel]="option">
                                            </nz-option>
                                          </nz-select>
                                        </div>
                                      </div>
                                    </div>
                                    <i class="anticon anticon-delete" (click)="deleteFunc('envfile', i, k)"></i>
                                    <!-- <button (click)="deleteFunc('log', i, k)">删除日志文件</button> -->
                                  </div>
                                  <!-- </div> -->
                                </form>
                                <div nz-row>
                                  <div nz-row>
                                    <div nz-col [nzSpan]="18" style="margin-left: 10px; margin-bottom: 10px">
                                      <div nz-row>
                                        <button nz-button [nzType]="'dashed'" [nzSize]="'large'" class="ant-btn__block mt-md" (click)="addEnvFile(k)">
                                          <i class="anticon anticon-plus"></i>
                                          <span>新增环境变量文件</span>
                                        </button>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <!-- 环境变量配置 -->
                      <div nz-row>
                        <div style="margin-bottom: 10px" nz-row>
                          <div nz-col [nzSpan]="4" style="text-align: right">
                          </div>
                          <div nz-col [nzSpan]="18" style="margin-left: 10px; margin-top: 4px">
                            <div nz-row>
                              <div nz-col [nzMd]="20">
                                <div nz-row [nzGutter]="16">
                                  <div nz-col [nzSpan]="10" *ngFor="let label of env1">
                                    <span>{{ label.value }}</span>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>

                      <!-- todo next -->
                      <div nz-row>
                        <div nz-row>
                          <div nz-col [nzSpan]="4" style="text-align: right">
                            <span style="display: block;
                                  font-size: 13px;
                                  font-weight: 400;
                                  letter-spacing: 0px;
                                  margin-bottom: 10px;
                                  color: rgba(0, 0, 0, 0.9);">环境变量</span>
                          </div>
                          <div nz-col [nzSpan]="18" style="margin-left: 10px; margin-top: 4px">
                            <div nz-row>
                              <div nz-col [nzMd]="20">
                                <form nz-form class="dynamic-form" [formGroup]="judgeFuncEnv(k, 'env')">
                                  <!-- <div nz-row [nzGutter]="16"> -->
                                  <div nz-row [nzGutter]="16" *ngFor="let control1 of judgeFuncEnv(k, 'config'); let i=index">
                                    <div [class.d-none]="!control.show" nz-col [nzSpan]="10" *ngFor="let control of control1">
                                      <div nz-form-item nz-row>
                                        <div *ngIf="control.type === 'input'" nz-form-control nz-col>
                                          <nz-input [nzSize]="'large'" [nzPlaceHolder]="control.placeholder" [formControlName]="control.name"></nz-input>
                                        </div>
                                      </div>
                                    </div>
                                    <i class="anticon anticon-delete" (click)="deleteFunc('env', i, k)"></i>
                                    <!-- <button (click)="deleteFunc('env', i, k)">删除环境变量</button> -->
                                  </div>
                                  <!-- </div> -->
                                </form>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div nz-row>
                        <div nz-row>
                          <div nz-col [nzSpan]="4" style="text-align: right">
                          </div>
                          <div nz-col [nzSpan]="18" style="margin-left: 10px; margin-bottom: 10px">
                            <div nz-row>
                              <button nz-button [nzType]="'dashed'" [nzSize]="'large'" class="ant-btn__block mt-md" (click)="addEnv(k)">
                                <i class="anticon anticon-plus"></i>
                                <span>新增环境变量</span>
                              </button>
                            </div>
                          </div>
                        </div>
                      </div>
                      <!-- 配置文件配置 -->
                      <div nz-row>
                        <div nz-row>
                          <div nz-col [nzSpan]="4" style="text-align: right">
                            <span style="display: block;
                                  font-size: 13px;
                                  font-weight: 400;
                                  letter-spacing: 0px;
                                  margin-bottom: 10px;
                                  color: rgba(0, 0, 0, 0.9);">配置文件</span>
                          </div>
                          <div nz-col [nzSpan]="18" style="margin-left: 10px; margin-top: 4px">
                            <nz-table #nzTable [nzAjaxData]="judgeFuncConfigFile(k, 'data')" [nzIsPagination]="false">
                              <thead nz-thead>
                                <tr>
                                  <th nz-th>
                                    <span>文件路径</span>
                                  </th>
                                  <th nz-th>
                                    <span>配置项</span>
                                  </th>
                                  <th nz-th>
                                    <span>操作</span>
                                  </th>
                                </tr>
                              </thead>
                              <tbody nz-tbody>
                                <tr nz-tbody-tr *ngFor="let data of nzTable.data; let l=index;">
                                  <td nz-td>
                                    {{data.path}}
                                  </td>
                                  <td nz-td>{{data.valueKey}}</td>
                                  <td nz-td>
                                    <i class="anticon anticon-delete" (click)="deleteFunc('config', l, k)"></i>
                                    <!-- <button (click)="deleteFunc('config', l, k)">删除配置文件</button> -->
                                  </td>
                                </tr>
                              </tbody>
                            </nz-table>
                          </div>
                        </div>
                      </div>
                      <div nz-row>
                        <div nz-row>
                          <div nz-col [nzSpan]="4" style="text-align: right">
                          </div>
                          <div nz-col [nzSpan]="18" style="margin-top: 10px; margin-left: 10px; margin-bottom: 10px">
                            <div nz-row>
                              <button nz-button [nzType]="'dashed'" [nzSize]="'large'" class="ant-btn__block mt-md" (click)="addConfigFile(k)">
                                <i class="anticon anticon-plus"></i>
                                <span>新增配置文件</span>
                              </button>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </nz-tab>
                </nz-tabset>
              </div>
            </div>

            <!-- 配置文件弹出框 -->
            <nz-modal [nzVisible]="isVisible" [nzTitle]="'添加配置文件'" [nzContent]="modalContent" (nzOnCancel)="handleCancelConfig($event)"
              (nzOnOk)="handleOkConfig($event)">
              <ng-template #modalContent>
                <div nz-row>
                  <div style="margin-bottom: 10px" nz-row>
                    <div nz-col [nzSpan]="4" style="text-align: right">
                      <span style="display: block;
                                            font-size: 13px;
                                            fonrgba(7, 6, 6, 0.9)
                                            letter-spacing: 0px;
                                            margin-bottom: 10px;
                                            color: rgba(0, 0, 0, 0.9);">内容选取方式</span>
                    </div>
                    <div nz-col [nzSpan]="18" style="margin-left: 10px; margin-top: 4px">
                      <nz-radio-group [(ngModel)]="this.configFileRadio">
                        <label nz-radio [nzValue]="'config'" style="margin-right: 25px">
                          <span>选择</span>
                        </label>
                      </nz-radio-group>
                    </div>
                  </div>
                  <dynamic-form #configFileForm [config]="configFile">
                  </dynamic-form>
                </div>
              </ng-template>
            </nz-modal>

            <!-- 存储卷弹出框 -->
            <nz-modal [nzVisible]="isVisibleStateful" [nzTitle]="'添加存储卷'" [nzContent]="modalContent1" (nzOnCancel)="handleCancelStateful($event)"
              (nzOnOk)="handleOkStateful($event)">
              <ng-template #modalContent1>
                <div nz-row>
                  <dynamic-form #statefulForm [config]="statefulConfig">
                  </dynamic-form>
                </div>
              </ng-template>
            </nz-modal>
          </nz-content>
        </nz-layout>
      </div>

      <!-- 服务配置 -->
      <div [hidden]="current !== 2">
        <nz-layout>
          <nz-content [hidden]="!ifServiceInstance || serviceTabs.length === 0">
            <nz-content style="margin-top: 0;">
              <div class="marginTop20">
                <div class="borderTop80" style="border: 0;padding-top: 0;">
                  <nz-alert class="service-tips" [nzType]="'info'">
                    <span alert-body nz-row>
                      <div style="text-align: center; font-size: 20px; color:#10a5ef" nz-col [nzSpan]="1">
                        <i class="anticon anticon-exclamation-circle-o"></i>
                      </div>
                      <div nz-col [nzSpan]="21">
                        <div>
                          <p>帮助提示</p>
                          <span>灰度部署是指版本升级时平滑过渡的方式，用户可先进行灰度发布至新版本。经过部分用户试用稳定后，正式升级至高版本。</span>
                        </div>
                      </div>
                    </span>
                  </nz-alert>
                </div>
              </div>
            </nz-content>
            <div class="marginTop20">
              <p>服务配置</p>
              <div class="borderTop80">
                <dynamic-form #formThird5Project [config]="formThird5"></dynamic-form>
              </div>
            </div>
            <div class="marginTop20" *ngIf="true === false">
              <p class="borderBottom80">基本配置</p>
              <div nz-row style="margin-bottom: 15px">
                <div style="margin-bottom: 10px" *ngIf="this.radioValue === 'product'" nz-row>
                  <div nz-col [nzSpan]="4" style="text-align: right">
                    <span style="display: block;
                                      font-size: 13px;
                                      font-weight: 400;
                                      letter-spacing: 0px;
                                      margin-bottom: 10px;
                                      color: rgba(0, 0, 0, 0.9);">集群</span>
                  </div>
                  <div nz-col [nzSpan]="18" style="margin-left: 10px; margin-top: 4px">
                    <nz-radio-group [(ngModel)]="this.networkRadioValue">
                      <label *ngFor="let cluster of prodCluster" nz-radio [nzValue]="cluster.name">
                        <span>{{ cluster.displayName }}</span>
                      </label>
                    </nz-radio-group>
                  </div>
                </div>
                <div style="margin-bottom: 10px" *ngIf="this.radioValue === 'test'" nz-row>
                  <div nz-col [nzSpan]="4" style="text-align: right">
                    <span style="display: block;
                                      font-size: 13px;
                                      font-weight: 400;
                                      letter-spacing: 0px;
                                      margin-bottom: 10px;
                                      color: rgba(0, 0, 0, 0.9);">集群</span>
                  </div>
                  <div nz-col [nzSpan]="18" style="margin-left: 10px; margin-top: 4px">
                    <nz-radio-group [(ngModel)]="this.networkRadioValue2">
                      <label *ngFor="let cluster of testCluster" nz-radio [nzValue]="cluster.name">
                        <span>{{ cluster.displayName }}</span>
                      </label>
                    </nz-radio-group>
                  </div>
                </div>
                <dynamic-form #formThirdProject [config]="formThird">
                </dynamic-form>
                <div *ngIf="formThird1.length > 0 && formThird1Radios.length > 0">
                  <div *ngIf="choosedServiceName  === 'redis'" class="marginBottom15" nz-row>
                    <div nz-col [nzSpan]="4" style="text-align: right">
                      <span style="display: block;
                                    font-size: 13px;
                                    font-weight: 400;
                                    letter-spacing: 0px;
                                    margin-bottom: 10px;
                                    color: rgba(0, 0, 0, 0.9);">运行模式</span>
                    </div>
                    <div nz-col [nzSpan]="18" style="margin-left: 10px; margin-top: 4px">
                      <nz-radio-group (click)="toggleRadio()" [(ngModel)]="this.modelValue">
                        <label nz-radio [nzValue]="'replication'">
                          <span>replication</span>
                        </label>
                      </nz-radio-group>
                    </div>
                  </div>
                  <!-- 这里可以用zookeeper && radio === true，也可以和上面redis一样的处理逻辑 -->
                  <!-- <dynamic-form *ngIf="choosedServiceName  === 'zookeeper'" #formThird4Project [config]="formThird4"></dynamic-form> -->
                  <dynamic-form #formThird1Project [config]="formThird1">
                  </dynamic-form>
                  <dynamic-form *ngIf="choosedServiceName  === 'redis'" #formThird3Project [config]="formThird3"></dynamic-form>
                  <div nz-row>
                    <div nz-col [nzSpan]="4" style="text-align: right">
                      <span style="display: block;
                                  font-size: 13px;
                                  font-weight: 400;
                                  letter-spacing: 0px;
                                  margin-bottom: 10px;
                                  color: rgba(0, 0, 0, 0.9);">容器实例大小</span>
                    </div>
                    <div nz-col [nzSpan]="18" style="margin-left: 10px">
                      <app-container-instance #instanceThird [config]="formThird1Radios">
                      </app-container-instance>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="marginTop20" *ngIf="true === false">
              <p class="borderBottom80">高级配置</p>
              <div nz-row style="margin-bottom: 15px">
                <dynamic-form #formThird2Project [config]="formThird2"></dynamic-form>
                <div class="marginBottom15" *ngFor="let formThird2Radio of formThird2Radios" nz-row>
                  <div nz-col [nzSpan]="4" style="text-align: right">
                    <span style="display: block;
                                  font-size: 13px;
                                  font-weight: 400;
                                  letter-spacing: 0px;
                                  margin-bottom: 10px;
                                  color: rgba(0, 0, 0, 0.9);">{{ formThird2Radio.label }}</span>
                  </div>
                  <div nz-col [nzSpan]="18" style="margin-left: 10px; margin-top: 4px">
                    <nz-radio-group (click)="toggleRadio()" [(ngModel)]="formThird2Radio.defaultValue">
                      <label *ngFor="let labelContent of formThird2Radio.labelContent" nz-radio [nzValue]="labelContent">
                        <span>{{ labelContent }}</span>
                      </label>
                    </nz-radio-group>
                  </div>
                </div>
                <!-- <dynamic-form *ngIf="choosedServiceName  === 'redis'" #formThird3Project [config]="formThird3"></dynamic-form> -->
                <!-- 这里可以用zookeeper && radio === true，也可以和上面redis一样的处理逻辑 -->
                <dynamic-form *ngIf="choosedServiceName  === 'zookeeper'" #formThird4Project [config]="formThird4"></dynamic-form>
              </div>
            </div>
          </nz-content>
          <nz-content *ngIf="!ifServiceInstance && serviceTabs.length !== 0">
            <nz-content style="margin-top: 0;">
              <div class="marginTop20">
                <div class="borderTop80" style="border: 0;padding-top: 0;">
                  <nz-alert class="service-tips" [nzType]="'info'">
                    <span alert-body nz-row>
                      <div style="text-align: center; font-size: 20px; color:#10a5ef" nz-col [nzSpan]="1">
                        <i class="anticon anticon-exclamation-circle-o"></i>
                      </div>
                      <div nz-col [nzSpan]="21">
                        <div>
                          <p>帮助提示</p>
                          <span>灰度部署是指版本升级时平滑过渡的方式，用户可先进行灰度发布至新版本。经过部分用户试用稳定后，正式升级至高版本。</span>
                        </div>
                      </div>
                    </span>
                  </nz-alert>
                </div>
              </div>
            </nz-content>
            <div class="marginTop20">
              <div class="borderTop80" style="border: 0;padding-top: 0;">
                <nz-alert class="service-tips" [nzType]="'info'">
                  <span alert-body nz-row>
                    <div style="text-align: center; font-size: 20px; color:#10a5ef" nz-col [nzSpan]="1">
                      <i class="anticon anticon-exclamation-circle-o"></i>
                    </div>
                    <div nz-col [nzSpan]="21">
                      <div>
                        <p>缺少服务实例</p>
                        <span>该应用所依赖的服务没有实例，请先订购服务实例!</span>
                      </div>
                    </div>
                  </span>
                </nz-alert>
              </div>
            </div>
          </nz-content>
          <nz-content *ngIf="serviceTabs.length === 0">
            <nz-content style="margin-top: 0;">
              <div class="marginTop20">
                <div class="borderTop80" style="border: 0;padding-top: 0;">
                  <nz-alert class="service-tips" [nzType]="'info'">
                    <span alert-body nz-row>
                      <div style="text-align: center; font-size: 20px; color:#10a5ef" nz-col [nzSpan]="1">
                        <i class="anticon anticon-exclamation-circle-o"></i>
                      </div>
                      <div nz-col [nzSpan]="21">
                        <div>
                          <p>帮助提示</p>
                          <span>灰度部署是指版本升级时平滑过渡的方式，用户可先进行灰度发布至新版本。经过部分用户试用稳定后，正式升级至高版本。</span>
                        </div>
                      </div>
                    </span>
                  </nz-alert>
                </div>
              </div>
            </nz-content>
            <div class="marginTop20">
              <div class="borderTop80" style="border: 0;padding-top: 0;">
                <nz-alert class="service-tips" [nzType]="'info'">
                  <span alert-body nz-row>
                    <div style="text-align: center; font-size: 20px; color:#10a5ef" nz-col [nzSpan]="1">
                      <i class="anticon anticon-exclamation-circle-o"></i>
                    </div>
                    <div nz-col [nzSpan]="21">
                      <div>
                        <p>无需服务配置</p>
                        <span>该应用没有依赖服务，请直接进行部署!</span>
                      </div>
                    </div>
                  </span>
                </nz-alert>
              </div>
            </div>
          </nz-content>
        </nz-layout>
      </div>

      <!-- 灰度策略 -->
      <div [hidden]="current !==3">
        <nz-layout>
          <nz-content>
            <nz-content style="margin-top: 0;">
              <div class="marginTop20">
                <div class="borderTop80" style="border: 0;padding-top: 0;">
                  <nz-alert class="service-tips" [nzType]="'info'">
                    <span alert-body nz-row>
                      <div style="text-align: center; font-size: 20px; color:#10a5ef" nz-col [nzSpan]="1">
                        <i class="anticon anticon-exclamation-circle-o"></i>
                      </div>
                      <div nz-col [nzSpan]="21">
                        <div>
                          <p>帮助提示</p>
                          <span>灰度部署是指版本升级时平滑过渡的方式，用户可先进行灰度发布至新版本。经过部分用户试用稳定后，正式升级至高版本。</span>
                        </div>
                      </div>
                    </span>
                  </nz-alert>
                </div>
              </div>
            </nz-content>
            <div class="marginTop20">
              <p>灰度策略</p>
              <div class="top80" nz-row>
                <div class="top20" *ngFor="let grayRule of grayRules; let i=index">
                  <div nz-row class="gray-header">
                    <div nz-col [nzSpan]="12">
                      <span>微服务{{ grayRule.microservice1.microserviceName }}: {{ grayRule.port }}</span>
                    </div>
                    <div style="text-align: right" nz-col [nzSpan]="12">
                      <span>负载均衡: {{ grayRule.lbName }}</span>
                      <span *ngIf="i === 0">
                        <nz-switch [(ngModel)]="checked0">
                          <span checked>开</span>
                          <span unchecked>关</span>
                        </nz-switch>
                      </span>
                      <span *ngIf="i === 1">
                        <nz-switch [(ngModel)]="checked1">
                          <span checked>开</span>
                          <span unchecked>关</span>
                        </nz-switch>
                      </span>
                      <span *ngIf="i === 2">
                        <nz-switch [(ngModel)]="checked2">
                          <span checked>开</span>
                          <span unchecked>关</span>
                        </nz-switch>
                      </span>
                      <span *ngIf="i === 3">
                        <nz-switch [(ngModel)]="checked3">
                          <span checked>开</span>
                          <span unchecked>关</span>
                        </nz-switch>
                      </span>
                      <span *ngIf="i === 4">
                        <nz-switch [(ngModel)]="checked4">
                          <span checked>开</span>
                          <span unchecked>关</span>
                        </nz-switch>
                      </span>
                    </div>
                  </div>
                  <!-- 微服务+端口地址配置 -->

                  <div class="gray-content-service" nz-row>
                    <div>
                      <form *ngIf="judgeFunc(i, 'grayRulesForm') !== undefined" nz-form class="dynamic-form" [formGroup]="judgeFunc(i, 'grayRulesForm')">
                        <div *ngFor="let control1 of grayRulesServiceArr; let i=index" nz-row>
                          <div *ngFor="let control of control1" nz-col [nzSpan]="12">
                            <div nz-form-item nz-row>
                              <div *ngIf="control.type === 'input'" nz-form-control nz-col>
                                <div nz-col [nzSpan]="8" style="text-align: right">
                                  <span style="display: block;
                                                                      font-size: 13px;
                                                                      font-weight: 400;
                                                                      letter-spacing: 0px;
                                                                      margin-bottom: 10px;
                                                                      color: rgba(0, 0, 0, 0.9);">端口地址</span>
                                </div>
                                <div nz-col [nzSpan]="8">
                                  <nz-input [ngModel]="control.defaultValue" [nzType]="control.inputType" [nzDisabled]="control.disabled" [nzSize]="'large'"
                                    [nzPlaceHolder]="control.placeholder" [formControlName]="control.name"></nz-input>
                                </div>
                              </div>
                              <div *ngIf="control.type === 'select'" nz-form-control nz-col>
                                <div nz-col [nzSpan]="8" style="text-align: right">
                                  <span style="display: block;
                                                              font-size: 13px;
                                                              font-weight: 400;
                                                              letter-spacing: 0px;
                                                              margin-bottom: 10px;
                                                              color: rgba(0, 0, 0, 0.9);">新版本微服务</span>
                                </div>
                                <div nz-col [nzSpan]="8">
                                  <nz-select [nzTags]="control.ifTags" [formControlName]="control.name" [nzPlaceHolder]="control.placeholder" nzAllowClear
                                    [nzDisabled]="control.disabled">
                                    <nz-option *ngFor="let option of control.options" [nzValue]="option" [nzLabel]="option">
                                    </nz-option>
                                  </nz-select>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </form>
                    </div>
                  </div>
                  <!-- 灰度策略,IP配置 -->
                  <!-- copy form template:
                  <div *ngIf="i === copy">
                    <div style="margin-top: 15px" nz-form-item nz-row *ngFor="let control of judgeFunc(i, 'control');let j = index;">
                      <div nz-form-control nz-col [nzSpan]="5" [nzOffset]="'4'" style="margin-right:10px">
                        <nz-select [nzSize]="'large'" [formControlName]="control.controlName" [(ngModel)]="selectedOptioncopy[j]">
                          <nz-option [nzLabel]="'固定IP'" [nzValue]="'equal'"></nz-option>
                          <nz-option [nzLabel]="'IP段限制'" [nzValue]="'range'"></nz-option>
                        </nz-select>
                      </div>
                      <div nz-form-control nz-col [nzSpan]="14" *ngIf="selectedOptioncopy[j] ==='equal'">
                        <nz-input style="margin-right:5px;" [nzSize]="'large'" [nzPlaceHolder]="'固定IP'" [formControlName]="control.controlInstance1"
                          [nzId]="control.id">
                        </nz-input>
                        <i class="anticon anticon-minus-circle-o dynamic-delete-button" (click)="removeIP(control,$event, i)"></i>
                      </div>
                      <div nz-form-control nz-col [nzSpan]="14" *ngIf="selectedOptioncopy[j] ==='range'">
                        <nz-input-group [nzSize]="'large'" nzCompact>
                          <nz-input style="width:40%;" [nzSize]="'large'" [nzPlaceHolder]="'IP段限制'" [formControlName]="control.controlInstance1" [nzId]="control.id">
                          </nz-input>
                          <div style="display: inline-block;vertical-align: top;margin: 0 10px;">~</div>
                          <nz-input style="width:40%;" [nzSize]="'large'" [nzPlaceHolder]="'IP段限制'" [formControlName]="control.controlInstance2" [nzId]="control.id">
                          </nz-input>
                        </nz-input-group>
                        <i class="anticon anticon-minus-circle-o dynamic-delete-button" (click)="removeIP(control,$event, i)"></i>
                      </div>
                    </div>
                  </div>
                  copy form template: -->
                  <div class="gray-content-ip" nz-row>
                    <form nz-form [formGroup]="judgeFunc(i, 'ipform')">
                      <div nz-form-item nz-row>
                        <div nz-col [nzSpan]="5" [nzOffset]="'3'">
                          <span style="margin-right: 7px">灰度策略</span>
                          <span>IP</span>
                        </div>
                      </div>
                      <!-- selectedOption0 -->
                      <div *ngIf="i === 0">
                        <div style="margin-top: 15px" nz-form-item nz-row *ngFor="let control of judgeFunc(i, 'control');let j = index;">
                          <div nz-form-control nz-col [nzSpan]="5" [nzOffset]="'4'" style="margin-right:10px">
                            <nz-select [nzPlaceHolder]="'请选择'" [nzSize]="'large'" [formControlName]="control.controlName" [(ngModel)]="selectedOption0[j]">
                              <nz-option [nzLabel]="'固定IP'" [nzValue]="'equal'"></nz-option>
                              <nz-option [nzLabel]="'IP段限制'" [nzValue]="'range'"></nz-option>
                            </nz-select>
                          </div>
                          <div nz-form-control nz-col [nzSpan]="14" *ngIf="selectedOption0[j] ==='equal'">
                            <nz-input style="margin-right:5px;" [nzSize]="'large'" [nzPlaceHolder]="'固定IP'" [formControlName]="control.controlInstance1"
                              [nzId]="control.id">
                            </nz-input>
                            <i class="anticon anticon-minus-circle-o dynamic-delete-button" (click)="removeIP(control,$event, i)"></i>
                            <!-- <div nz-form-explain *ngIf="getUpdateFormControl(control.controlInstance)?.dirty&&getUpdateFormControl(control.controlInstance)?.hasError('required')">
                                  请填写相应的IP值或删除空选项
                                </div> -->
                          </div>
                          <div nz-form-control nz-col [nzSpan]="14" *ngIf="selectedOption0[j] ==='range'">
                            <nz-input-group [nzSize]="'large'" nzCompact>
                              <nz-input style="width:40%;" [nzSize]="'large'" [nzPlaceHolder]="'IP段限制'" [formControlName]="control.controlInstance1" [nzId]="control.id">
                              </nz-input>
                              <div style="display: inline-block;vertical-align: top;margin: 0 10px;">~</div>
                              <nz-input style="width:40%;" [nzSize]="'large'" [nzPlaceHolder]="'IP段限制'" [formControlName]="control.controlInstance2" [nzId]="control.id">
                              </nz-input>
                            </nz-input-group>
                            <i class="anticon anticon-minus-circle-o dynamic-delete-button" (click)="removeIP(control,$event, i)"></i>
                            <!-- <div nz-form-explain *ngIf="getUpdateFormControl(control.controlInstance)?.dirty&&getUpdateFormControl(control.controlInstance)?.hasError('required')">
                                  请填写相应的IP值或删除空选项
                                </div> -->
                          </div>
                        </div>
                      </div>
                      <!-- selectedOption1 -->
                      <div *ngIf="i === 1">
                        <div style="margin-top: 15px" nz-form-item nz-row *ngFor="let control of judgeFunc(i, 'control');let j = index;">
                          <div nz-form-control nz-col [nzSpan]="5" [nzOffset]="'4'" style="margin-right:10px">
                            <nz-select [nzPlaceHolder]="'请选择'" [nzSize]="'large'" [formControlName]="control.controlName" [(ngModel)]="selectedOption1[j]">
                              <nz-option [nzLabel]="'固定IP'" [nzValue]="'equal'"></nz-option>
                              <nz-option [nzLabel]="'IP段限制'" [nzValue]="'range'"></nz-option>
                            </nz-select>
                          </div>
                          <div nz-form-control nz-col [nzSpan]="14" *ngIf="selectedOption1[j] ==='equal'">
                            <nz-input style="margin-right:5px;" [nzSize]="'large'" [nzPlaceHolder]="'固定IP'" [formControlName]="control.controlInstance1"
                              [nzId]="control.id">
                            </nz-input>
                            <i class="anticon anticon-minus-circle-o dynamic-delete-button" (click)="removeIP(control,$event, i)"></i>
                            <!-- <div nz-form-explain *ngIf="getUpdateFormControl(control.controlInstance)?.dirty&&getUpdateFormControl(control.controlInstance)?.hasError('required')">
                                    请填写相应的IP值或删除空选项
                                  </div> -->
                          </div>
                          <div nz-form-control nz-col [nzSpan]="14" *ngIf="selectedOption1[j] ==='range'">
                            <nz-input-group [nzSize]="'large'" nzCompact>
                              <nz-input style="width:40%;" [nzSize]="'large'" [nzPlaceHolder]="'IP段限制'" [formControlName]="control.controlInstance1" [nzId]="control.id">
                              </nz-input>
                              <div style="display: inline-block;vertical-align: top;margin: 0 10px;">~</div>
                              <nz-input style="width:40%;" [nzSize]="'large'" [nzPlaceHolder]="'IP段限制'" [formControlName]="control.controlInstance2" [nzId]="control.id">
                              </nz-input>
                            </nz-input-group>
                            <i class="anticon anticon-minus-circle-o dynamic-delete-button" (click)="removeIP(control,$event, i)"></i>
                            <!-- <div nz-form-explain *ngIf="getUpdateFormControl(control.controlInstance)?.dirty&&getUpdateFormControl(control.controlInstance)?.hasError('required')">
                                    请填写相应的IP值或删除空选项
                                  </div> -->
                          </div>
                        </div>
                      </div>
                      <!-- selectedOption2 -->
                      <div *ngIf="i === 2">
                        <div style="margin-top: 15px" nz-form-item nz-row *ngFor="let control of judgeFunc(i, 'control');let j = index;">
                          <div nz-form-control nz-col [nzSpan]="5" [nzOffset]="'4'" style="margin-right:10px">
                            <nz-select [nzPlaceHolder]="'请选择'" [nzSize]="'large'" [formControlName]="control.controlName" [(ngModel)]="selectedOption2[j]">
                              <nz-option [nzLabel]="'固定IP'" [nzValue]="'equal'"></nz-option>
                              <nz-option [nzLabel]="'IP段限制'" [nzValue]="'range'"></nz-option>
                            </nz-select>
                          </div>
                          <div nz-form-control nz-col [nzSpan]="14" *ngIf="selectedOption2[j] ==='equal'">
                            <nz-input style="margin-right:5px;" [nzSize]="'large'" [nzPlaceHolder]="'固定IP'" [formControlName]="control.controlInstance1"
                              [nzId]="control.id">
                            </nz-input>
                            <i class="anticon anticon-minus-circle-o dynamic-delete-button" (click)="removeIP(control,$event, i)"></i>
                            <!-- <div nz-form-explain *ngIf="getUpdateFormControl(control.controlInstance)?.dirty&&getUpdateFormControl(control.controlInstance)?.hasError('required')">
                                      请填写相应的IP值或删除空选项
                                    </div> -->
                          </div>
                          <div nz-form-control nz-col [nzSpan]="14" *ngIf="selectedOption2[j] ==='range'">
                            <nz-input-group [nzSize]="'large'" nzCompact>
                              <nz-input style="width:40%;" [nzSize]="'large'" [nzPlaceHolder]="'IP段限制'" [formControlName]="control.controlInstance1" [nzId]="control.id">
                              </nz-input>
                              <div style="display: inline-block;vertical-align: top;margin: 0 10px;">~</div>
                              <nz-input style="width:40%;" [nzSize]="'large'" [nzPlaceHolder]="'IP段限制'" [formControlName]="control.controlInstance2" [nzId]="control.id">
                              </nz-input>
                            </nz-input-group>
                            <i class="anticon anticon-minus-circle-o dynamic-delete-button" (click)="removeIP(control,$event, i)"></i>
                            <!-- <div nz-form-explain *ngIf="getUpdateFormControl(control.controlInstance)?.dirty&&getUpdateFormControl(control.controlInstance)?.hasError('required')">
                                      请填写相应的IP值或删除空选项
                                    </div> -->
                          </div>
                        </div>
                      </div>
                      <!-- selectedOption3 -->
                      <div *ngIf="i === 3">
                        <div style="margin-top: 15px" nz-form-item nz-row *ngFor="let control of judgeFunc(i, 'control');let j = index;">
                          <div nz-form-control nz-col [nzSpan]="5" [nzOffset]="'4'" style="margin-right:10px">
                            <nz-select [nzPlaceHolder]="'请选择'" [nzSize]="'large'" [formControlName]="control.controlName" [(ngModel)]="selectedOption3[j]">
                              <nz-option [nzLabel]="'固定IP'" [nzValue]="'equal'"></nz-option>
                              <nz-option [nzLabel]="'IP段限制'" [nzValue]="'range'"></nz-option>
                            </nz-select>
                          </div>
                          <div nz-form-control nz-col [nzSpan]="14" *ngIf="selectedOption3[j] ==='equal'">
                            <nz-input style="margin-right:5px;" [nzSize]="'large'" [nzPlaceHolder]="'固定IP'" [formControlName]="control.controlInstance1"
                              [nzId]="control.id">
                            </nz-input>
                            <i class="anticon anticon-minus-circle-o dynamic-delete-button" (click)="removeIP(control,$event, i)"></i>
                            <!-- <div nz-form-explain *ngIf="getUpdateFormControl(control.controlInstance)?.dirty&&getUpdateFormControl(control.controlInstance)?.hasError('required')">
                                        请填写相应的IP值或删除空选项
                                      </div> -->
                          </div>
                          <div nz-form-control nz-col [nzSpan]="14" *ngIf="selectedOption3[j] ==='range'">
                            <nz-input-group [nzSize]="'large'" nzCompact>
                              <nz-input style="width:40%;" [nzSize]="'large'" [nzPlaceHolder]="'IP段限制'" [formControlName]="control.controlInstance1" [nzId]="control.id">
                              </nz-input>
                              <div style="display: inline-block;vertical-align: top;margin: 0 10px;">~</div>
                              <nz-input style="width:40%;" [nzSize]="'large'" [nzPlaceHolder]="'IP段限制'" [formControlName]="control.controlInstance2" [nzId]="control.id">
                              </nz-input>
                            </nz-input-group>
                            <i class="anticon anticon-minus-circle-o dynamic-delete-button" (click)="removeIP(control,$event, i)"></i>
                            <!-- <div nz-form-explain *ngIf="getUpdateFormControl(control.controlInstance)?.dirty&&getUpdateFormControl(control.controlInstance)?.hasError('required')">
                                        请填写相应的IP值或删除空选项
                                      </div> -->
                          </div>
                        </div>
                      </div>
                      <!-- selectedOption4 -->
                      <div *ngIf="i === 4">
                        <div style="margin-top: 15px" nz-form-item nz-row *ngFor="let control of judgeFunc(i, 'control');let j = index;">
                          <div nz-form-control nz-col [nzSpan]="5" [nzOffset]="'4'" style="margin-right:10px">
                            <nz-select [nzPlaceHolder]="'请选择'" [nzSize]="'large'" [formControlName]="control.controlName" [(ngModel)]="selectedOption4[j]">
                              <nz-option [nzLabel]="'固定IP'" [nzValue]="'equal'"></nz-option>
                              <nz-option [nzLabel]="'IP段限制'" [nzValue]="'range'"></nz-option>
                            </nz-select>
                          </div>
                          <div nz-form-control nz-col [nzSpan]="14" *ngIf="selectedOption4[j] ==='equal'">
                            <nz-input style="margin-right:5px;" [nzSize]="'large'" [nzPlaceHolder]="'固定IP'" [formControlName]="control.controlInstance1"
                              [nzId]="control.id">
                            </nz-input>
                            <i class="anticon anticon-minus-circle-o dynamic-delete-button" (click)="removeIP(control,$event, i)"></i>
                            <!-- <div nz-form-explain *ngIf="getUpdateFormControl(control.controlInstance)?.dirty&&getUpdateFormControl(control.controlInstance)?.hasError('required')">
                                          请填写相应的IP值或删除空选项
                                        </div> -->
                          </div>
                          <div nz-form-control nz-col [nzSpan]="14" *ngIf="selectedOption4[j] ==='range'">
                            <nz-input-group [nzSize]="'large'" nzCompact>
                              <nz-input style="width:40%;" [nzSize]="'large'" [nzPlaceHolder]="'IP段限制'" [formControlName]="control.controlInstance1" [nzId]="control.id">
                              </nz-input>
                              <div style="display: inline-block;vertical-align: top;margin: 0 10px;">~</div>
                              <nz-input style="width:40%;" [nzSize]="'large'" [nzPlaceHolder]="'IP段限制'" [formControlName]="control.controlInstance2" [nzId]="control.id">
                              </nz-input>
                            </nz-input-group>
                            <i class="anticon anticon-minus-circle-o dynamic-delete-button" (click)="removeIP(control,$event, i)"></i>
                            <!-- <div nz-form-explain *ngIf="getUpdateFormControl(control.controlInstance)?.dirty&&getUpdateFormControl(control.controlInstance)?.hasError('required')">
                                          请填写相应的IP值或删除空选项
                                        </div> -->
                          </div>
                        </div>
                      </div>
                      <div style="margin-top: 20px" nz-form-item nz-row>
                        <div nz-form-control nz-col [nzSpan]="20" [nzOffset]="4">
                          <button nz-button [nzType]="'dashed'" [nzSize]="'large'" (click)="addIP($event, i)">
                            <i class="anticon anticon-plus"></i>
                            <span>继续增加IP</span>
                          </button>
                        </div>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </nz-content>
        </nz-layout>
      </div>
    </div>
  </div>
  <div class="steps-action" nz-row>
    <!-- TODO -->
    <!-- disabled? next函数控制 -->
    <div nz-col [nzSpan]="4"></div>
    <div nz-col [nzSpan]="18">
      <span [hidden]="current >= 3">
        <button [disabled]="buttonDisabled()" nz-button [nzType]="'primary'" (click)="next()">
          <span>下一步</span>
        </button>
      </span>
      <span [hidden]="current !== 3">
        <button nz-button [nzLoading]="isLoadingDone" [disabled]="buttonDisabled() || (!ifServiceInstance && serviceTabs.length !== 0)"
          nz-button [nzType]="'primary'" (click)="done()">
          <span>部署</span>
        </button>
      </span>
      <span [hidden]="current <= 0">
        <button nz-button [nzType]="'default'" (click)="pre()">
          <span>上一步</span>
        </button>
      </span>
      <span [hidden]="current !== 0">
        <button nz-button [nzType]="'default'" (click)="pre()">
          <span>取消</span>
        </button>
      </span>
    </div>
  </div>
</div>