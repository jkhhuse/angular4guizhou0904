<div class="app-overview">
  <app-header [title]="title"></app-header>
  <app-group-select (groupidHandler)="groupidHandler($event)"></app-group-select>

  <nz-content class="overview-content-wrapper">
    <div class="app-overview-totals">
      <div nz-row [nzGutter]="30">
        <div nz-col class="total-row" [nzSpan]="8">
          <div class="total-box">
            <img [src]="appImgUrl1" alt="" width="100%" class="appImg"/>
            <span class="app-total-span">应用总数</span>
            <span class="app-total-num num-color1" *ngIf="totals">{{totals.appTotalNum ? totals.appTotalNum : 0}}</span>
          </div>
        </div>
        <div nz-col class="total-row" [nzSpan]="8">
          <div class="total-box">
            <img [src]="appImgUrl1" alt="" width="100%" class="appImg"/>
            <span class="app-total-span">容器个数</span>
            <span class="app-total-num num-color2"
                  *ngIf="totals">{{totals.dockerTotalNum ? totals.dockerTotalNum : 0}}</span>
          </div>
        </div>
        <div nz-col class="total-row" [nzSpan]="8">
          <div class="total-box">
            <img [src]="appImgUrl2" alt="" width="100%" class="appImg"/>
            <span class="app-total-span">项目个数</span>
            <span class="app-total-num num-color3" *ngIf="totals">{{totals.projectTotalNum ? totals.projectTotalNum : 0}}</span>
          </div>
        </div>
      </div>
    </div>
    <nz-tabset [nzTabPosition]="'top'" [nzType]="'card'" class="mirrorTab">
      <nz-tab *ngFor="let tab of tabs" [nzDisabled]="tab.disabled" (nzClick)="changeMirrorName(tab.tabName)">
        <ng-template #nzTabHeading>
          {{tab.name}}
        </ng-template>
        <nz-table #nzTable
                  [nzAjaxData]="_dataSet"
                  [nzShowSizeChanger]="true"
                  [nzShowTotal]="true"
                  [nzLoading]="_loading"
                  [nzTotal]="_total"
                  [(nzPageIndex)]="_current"
                  (nzPageIndexChange)="refreshData()"
                  [(nzPageSize)]="_pageSize"
                  (nzPageSizeChange)="refreshData(true)">
          <thead nz-thead>
          <tr>
            <th nz-th>
              <span>实例名称</span>
              <nz-table-sort [(nzValue)]="sortMap.instanceName"
                             (nzValueChange)="sort('instanceName', $event)"></nz-table-sort>
            </th>

            <th nz-th>
              <span>应用名称</span>
              <nz-table-sort [(nzValue)]="sortMap.opContainerApp"
                             (nzValueChange)="sort('opContainerApp', $event)"></nz-table-sort>
            </th>
            <th nz-th>
              <span>状态</span>
              <nz-table-sort [(nzValue)]="sortMap.status"
                             (nzValueChange)="sort('status', $event)"></nz-table-sort>
            </th>
            <th nz-th>
              <span>大小</span>
              <nz-table-sort [(nzValue)]="sortMap.cpuSize"
                             (nzValueChange)="sort('cpuSize', $event)"></nz-table-sort>
            </th>
            <th nz-th>
              <span>服务数量</span>
              <nz-table-sort [(nzValue)]="sortMap.instancesCount"
                             (nzValueChange)="sort('instancesCount', $event)"></nz-table-sort>
            </th>
            <th nz-th>
              <span>创建时间</span>
              <nz-table-sort [(nzValue)]="sortMap.createTime"
                             (nzValueChange)="sort('createTime', $event)"></nz-table-sort>
            </th>
            <th nz-th>
              <span>操作</span>
            </th>
          </tr>
          </thead>
          <tbody nz-tbody>
          <tr nz-tbody-tr *ngFor="let data of nzTable.data  | appFilter: 'instanceName' : keyword">
            <td nz-td>
              <a [routerLink]="['/appOverviewDetail', data.id]">
                {{data.instanceName}}
              </a>
            </td>
            <td nz-td>{{data.opContainerApp}}</td>
            <td nz-td>{{data.status}}</td>
            <td nz-td>{{data.cpuSize}}核 {{data.memSize}}M</td>
            <td nz-td>{{data.instancesCount}} 个</td>
            <td nz-td>{{data.createTime | date:'yyyy-MM-dd HH:mm:ss'}}</td>
            <td nz-td>
              <button nz-button [nzType]="'primary'" nzSize="small" (click)="showModal(data.id, data.instanceName);">
                <span>删除</span>
              </button>
            </td>
          </tr>
          </tbody>
        </nz-table>
      </nz-tab>
    </nz-tabset>
  </nz-content>
</div>

<nz-modal [nzVisible]="isVisible" [nzTitle]="'操作确认'" [nzContent]="modalContent" (nzOnCancel)="handleCancel($event)"
          (nzOnOk)="handleOk($event)">
  <ng-template #modalContent>
    <p>已选择应用实例：{{deleteName}}，是否确定删除？</p>
    <nz-spin [nzSize]="'large'" [nzSpinning]="_isSpinning" [nzTip]="'删除中'" style="text-align: center;">
    </nz-spin>

  </ng-template>
</nz-modal>
